<div class="flex flex-col gap-4 p-6">
  <div class="flex flex-row items-center gap-2 text-lg text-neutral-500">
    <a routerLink="/bottling" class="cursor-pointer hover:underline">Bottling</a>
    <span class="material-symbols-outlined"> keyboard_arrow_right </span>
    create
  </div>

  <div [formGroup]="bottleFormGroup" class="flex w-full flex-row gap-4">
    <div class="flex flex-1 flex-col gap-4">
      <div class="grid grid-cols-2 gap-x-2 gap-y-4 rounded-lg bg-white p-4">
        <span class="col-span-2 text-neutral-700"> General Information </span>
        <mat-form-field appearance="outline">
          <mat-label>Date</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            formControlName="date"
            [max]="dateDelimiter"
            placeholder="Choose a date"
          />
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Time</mat-label>
          <input
            matInput
            [matTimepicker]="timepicker"
            formControlName="time"
            [max]="dateDelimiter"
            placeholder="Pick a time"
          />
          <mat-timepicker-toggle matIconSuffix [for]="timepicker" />
          <mat-timepicker #timepicker />
        </mat-form-field>

        <mat-button-toggle-group formControlName="amount" required="true" class="col-span-2">
          <mat-button-toggle value="10" class="w-1/2">10 kg</mat-button-toggle>
          <mat-button-toggle value="50" class="w-1/2">50 kg</mat-button-toggle>
        </mat-button-toggle-group>

        <mat-form-field appearance="outline">
          <mat-label>Recipients</mat-label>
          <mat-select formControlName="recipient" placeholder="Select a Recipient">
            @if (recipientsQuery.isSuccess() && recipientsQuery.data().length) {
              @for (recipient of recipientsQuery.data(); track recipient) {
                <mat-option [value]="recipient">{{ recipient.name }}</mat-option>
              }
            } @else {
              <mat-option [value]="null">No data found.</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Units</mat-label>
          <mat-select formControlName="storageUnit" placeholder="Select a Unit" #storage>
            @for (unit of hydrogenStorageQuery.data(); track unit) {
              <mat-option [value]="unit" [disabled]="(bottleFormGroup.value.amount ?? 0) > unit.filling"
                >{{ unit.name }} ({{ unit.filling | number }} kg)
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="flex flex-col gap-2 rounded-lg bg-white p-4">
        <h3 class="pb-1 text-neutral-700">Select Hydrogen Composition</h3>
        @if (storage.value && bottleFormGroup.value.amount) {
          <mat-radio-group
            required
            class="flex w-full flex-row gap-2"
            aria-label="Select an option"
            formControlName="type"
          >
            <div
              class="flex w-1/3 flex-col rounded-md border-[2px] border-solid p-2"
              [ngClass]="
                bottleFormGroup.value.type === 'GREEN'
                  ? 'border-primary-400 text-primary-100'
                  : 'border-neutral-400 text-neutral-500'
              "
            >
              <mat-radio-button
                #green
                value="GREEN"
                [disabled]="!isAmountAvailable(bottleFormGroup.value.amount, storage.value.hydrogenComposition)"
                >GREEN</mat-radio-button
              >
              <span class="ml-2 text-sm"
                >The bottling will contain green hydrogen only. Available Amount:
                {{ getAvailableGreenAmount(storage.value.hydrogenComposition) | number }} kg</span
              >
            </div>
            <div
              class="flex w-2/3 flex-col rounded-md border-[2px] border-solid p-2"
              [ngClass]="
                bottleFormGroup.value.type === 'MIX'
                  ? 'border-primary-400 text-primary-100'
                  : 'border-neutral-400 text-neutral-500'
              "
            >
              <mat-radio-button #mix value="MIX">MIX</mat-radio-button>
              <span class="ml-2 text-sm"
                >The composition of the filling will correspond to the hydrogen composition of the selected storage
                unit: {{ displayComposition(storage.value.hydrogenComposition) }}.</span
              >
            </div>
          </mat-radio-group>
        } @else {
          <span class="text-sm text-neutral-500">Please choose a storage unit and the desired amount first.</span>
        }
      </div>
      <div class="grid grid-cols-2 gap-2 rounded-lg bg-white p-4" [formGroup]="bottleFormGroup">
        <span class="col-span-2 text-neutral-700"> Transport Information </span>

        <mat-radio-group
          required
          class="col-span-2 flex flex-row gap-4"
          aria-label="Select an option"
          formControlName="transportMode"
        >
          <mat-radio-button [value]="TransportType.PIPELINE">{{ TransportType.PIPELINE | titlecase }}</mat-radio-button>
          <mat-radio-button [value]="TransportType.TRAILER">{{ TransportType.TRAILER | titlecase }}</mat-radio-button>
        </mat-radio-group>

        @if (bottleFormGroup.controls.transportMode.value === TransportType.TRAILER) {
          <mat-form-field appearance="outline">
            <mat-label>Fuel Type</mat-label>

            <mat-select formControlName="fuelType">
              <mat-option [value]="FuelType.DIESEL">Diesel</mat-option>
            </mat-select>
          </mat-form-field>
        }
      </div>
    </div>
    <app-upload-form
      class="flex-1 rounded-lg bg-white p-4"
      [title]="'Add Files'"
      [uploadedFiles]="uploadedFiles"
      (uploadDocument)="submitFile($event)"
      (removeDocument)="removeFile($event)"
    ></app-upload-form>
  </div>

  <div class="col-span-2 grid grid-cols-2 gap-2 rounded-lg bg-white p-4" [formGroup]="bottleFormGroup">
    <div class="col-span-2 flex justify-end gap-2">
      <button mat-flat-button (click)="createBottleData()" [disabled]="!bottleFormGroup.valid">Add Bottle</button>
    </div>
  </div>
</div>
